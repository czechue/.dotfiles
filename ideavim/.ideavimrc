" ===================================================================
" IdeaVim Configuration - TypeScript-Focused Hybrid Approach
" ===================================================================
" Three-layer shortcut system:
"   1. Fast Layer (Native IntelliJ - 1 keystroke): Cmd+B, Option+Enter
"   2. Medium Layer (Vim-style - 2 keystrokes): gd, gr, gh, gi
"   3. Discoverable Layer (Leader-key - 3 keystrokes): <leader>gd, <leader>sf
"
" Use the appropriate layer based on your flow state and familiarity.
" ===================================================================

" Basic settings
set scrolloff=10
set incsearch
set which-key
set notimeout
set timeout=5000
set clipboard^=unnamed,unnamedplus
set matchpairs+=<:>
set ideajoin
set smartcase

" Enable plugins
Plug 'machakann/vim-highlightedyank'
Plug 'tpope/vim-commentary'
Plug 'preservim/nerdtree'
Plug 'tpope/vim-surround'
Plug 'terryma/vim-multiple-cursors'

" Leader key
let mapleader = ' '
let g:WhichKey_ShowVimActions = "true"
let g:WhichKey_DefaultDelay = 100

" ===================================================================
" IMPORTANT: Preserve These Native IntelliJ Shortcuts
" ===================================================================
" These shortcuts are NOT remapped - use them directly!
"
" Navigation & Search:
"   Cmd+B           - Go to Declaration (FASTEST - use this!)
"   Cmd+Shift+B     - Go to Type Declaration
"   Cmd+Option+B    - Go to Implementation
"   Option+F7       - Find Usages
"   Cmd+[, Cmd+]    - Navigate Back/Forward
"   Double Shift    - Search Everywhere (universal search!)
"   Cmd+E           - Recent Files
"   Cmd+Shift+E     - Recent Edited Files
"
" Quick Fixes & Refactoring:
"   Option+Enter    - Show Intention Actions (auto-import, quick fixes) ‚≠ê
"   Ctrl+T          - Refactor This (context-aware refactoring menu) ‚≠ê
"   Shift+F6        - Rename Element
"   Cmd+Option+L    - Reformat Code (industry standard)
"   Ctrl+Option+O   - Optimize Imports
"
" Code Intelligence:
"   Cmd+P           - Parameter Info
"   F1              - Quick Documentation
"   Cmd+F12         - File Structure Popup
"   Ctrl+Space      - Basic Completion
"   Ctrl+Shift+Space - Smart Type Completion (TypeScript)
"
" Errors & Debugging:
"   F2, Shift+F2    - Next/Previous Error (faster than <leader>en/ep)
"   Cmd+F8          - Toggle Breakpoint
"   Ctrl+D          - Debug
"   Ctrl+R          - Run
"
" Discovery:
"   Cmd+Shift+A     - Find Action (command palette) ‚≠ê
"
" ===================================================================


map <C-e> <Action>(ActivateProjectToolWindow)

" Window navigation (zgodne z Neovim)
map <C-h> <C-w>h
map <C-j> <C-w>j
map <C-k> <C-w>k
map <C-l> <C-w>l

" Window management (zgodne z Neovim)
map <leader>wv <Action>(SplitVertically)
map <leader>wh <Action>(SplitHorizontally)
map <leader>ww <Action>(Unsplit)
map <leader>wa <Action>(UnsplitAll)

" Search and navigation (zgodne z Telescope w Neovim)
map <leader>sf <Action>(GotoFile)
map <leader>sg <Action>(FindInPath)
map <leader>ss <Action>(GotoSymbol)
map <leader>sa <Action>(GotoAction)
map <leader>sd <Action>(ShowErrorDescription)
map <leader>sr <Action>(RecentFiles)

" ===================================================================
" LSP/Code Intelligence - Three-Layer Approach
" ===================================================================
" Layer 1 (Fast): Cmd+B, Cmd+Shift+B, Cmd+Option+B (native shortcuts)
" Layer 2 (Medium): gd, gr, gi, gh (Vim-style - 2 keystrokes)
" Layer 3 (Discoverable): <leader>g* (leader-key - appears in Which-Key)

" Vim-style navigation shortcuts (2 keystrokes - FAST!)
nmap gd <Action>(GotoDeclaration)
nmap gD <Action>(GotoTypeDeclaration)
nmap gi <Action>(GotoImplementation)
nmap gr <Action>(ShowUsages)
nmap gh <Action>(QuickJavaDoc)

" Leader-key navigation (3 keystrokes - DISCOVERABLE via Which-Key)
map <leader>gd <Action>(GotoDeclaration)
map <leader>gy <Action>(GotoTypeDeclaration)
map <leader>gi <Action>(GotoImplementation)
map <leader>gt <Action>(GotoTest)
map <leader>gr <Action>(ShowUsages)

" Rename (multiple options for flexibility)
map <leader>rn <Action>(RenameElement)
" Note: Shift+F6 is native shortcut (faster)

" ===================================================================
" Code Actions & Refactoring
" ===================================================================
" Note: Option+Enter (native) for intention actions - THE most important!
" Note: Ctrl+T (native) for Refactor This menu - shows ALL refactorings!

" Intention actions and quick fixes
map <leader>ca <Action>(ShowIntentionActions)
" Note: Option+Enter is native and faster - preserve it!

" Refactor This - context-aware refactoring menu
map <leader>rt <Action>(RefactoringMenu)
" Note: Ctrl+T is native - shows all available refactorings in context

" Surround with (wrap with if, try-catch, etc.)
map <leader>sw <Action>(SurroundWith)

" ===================================================================
" vim-surround shortcuts (already working!)
" ===================================================================
" Note: vim-surround works natively! Commands available:
"   ys{motion}{char} - surround (e.g., ysiw" surrounds word with quotes)
"   cs{old}{new}     - change surround (e.g., cs"' changes " to ')
"   ds{char}         - delete surround (e.g., ds" removes quotes)
"   S{char}          - in Visual mode, surround selection
"
" Common patterns for quick reference:
"   ysiw"  - surround word with "quotes"
"   ysiw)  - surround word with (parentheses)
"   ysiw}  - surround word with {braces}
"   ysiw]  - surround word with [brackets]
"   cs"'   - change "double" to 'single' quotes
"   ds"    - delete surrounding "quotes"
"   dst    - delete surrounding HTML <tag>
"
" TypeScript-specific: Quick surround for template literals
" (Optional) Map common TypeScript surrounds if needed:
" nmap <leader>s` ysiw`
" nmap <leader>s" ysiw"
" nmap <leader>s' ysiw'

" Generate menu (constructors, getters, setters, toString, etc.)
map <S-space> <Action>(Generate)
map <leader>ge <Action>(Generate)
" Note: Cmd+N is native shortcut in editor context

" Extract refactorings
map <leader>rm <Action>(ExtractMethod)
map <leader>rv <Action>(IntroduceVariable)
map <leader>rf <Action>(IntroduceField)
map <leader>rp <Action>(IntroduceParameter)

" Inline refactoring (reverse of extract)
map <leader>ri <Action>(Inline)

" Change signature (modify function parameters)
map <leader>rs <Action>(ChangeSignature)

" Move refactoring (move functions/classes between files)
map <leader>mov <Action>(Move)

" Safe delete (checks usages before deleting)
map <leader>del <Action>(SafeDelete)

" Errors navigation
map <leader>en <Action>(GotoNextError)
map <leader>ep <Action>(GotoPreviousError)

" File operations
map <leader>qq <Action>(CloseContent)
map <leader>qa <Action>(CloseAllEditors)
map <leader>nf <Action>(NewFile)
map <leader>nd <Action>(NewDir)

" ===================================================================
" Code Intelligence & Documentation
" ===================================================================

" Quick documentation (like Vim's K)
map <leader>K <Action>(QuickJavaDoc)
" Note: F1 is native shortcut

" Parameter information
map <leader>p <Action>(ParameterInfo)
" Note: Cmd+P is native shortcut

" File structure popup (quick symbol overview)
map <leader>so <Action>(FileStructurePopup)
" Note: Cmd+F12 is native shortcut

" Type info at cursor
map <leader>ti <Action>(ExpressionTypeInfo)

" ===================================================================
" Code Formatting & Optimization
" ===================================================================

" Reformat code
map <leader>f <Action>(ReformatCode)
" Note: Cmd+Option+L is native and industry standard - preserve it!

" Optimize imports (remove unused, organize)
map <leader>oi <Action>(OptimizeImports)
" Note: Ctrl+Option+O is native shortcut

" Complete current statement (add semicolons, braces, etc.)
imap <C-CR> <Action>(CompleteStatement)
" Note: Cmd+Shift+Enter is native shortcut

" Movement and text manipulation
vmap <S-j> <Action>(MoveLineDown)
vmap <S-k> <Action>(MoveLineUp)

" Remap multiple-cursors shortcuts to match terryma/vim-multiple-cursors
nmap <C-g> <Plug>NextWholeOccurrence
xmap <C-g> <Plug>NextWholeOccurrence
nmap g<C-g> <Plug>NextOccurrence
xmap g<C-g> <Plug>NextOccurrence
xmap <C-x> <Plug>SkipOccurrence
xmap <C-p> <Plug>RemoveOccurrence

" Note that the default <A-n> and g<A-n> shortcuts don't work on Mac due to dead keys.
" <A-n> is used to enter accented text e.g. √±
" Feel free to pick your own mappings that are not affected. I like to use <leader>
nmap <leader><C-g> <Plug>AllWholeOccurrences
xmap <leader><C-g> <Plug>AllWholeOccurrences
nmap <leader>g<C-g> <Plug>AllOccurrences
xmap <leader>g<C-g> <Plug>AllOccurrences

" ===================================================================
" TypeScript-Specific Actions
" ===================================================================

" Implement/Override Methods
map <leader>im <Action>(ImplementMethods)
map <leader>om <Action>(OverrideMethods)

" ===================================================================
" Editor Font Size / Zoom
" ===================================================================
" Override default IntelliJ behavior:
"   Default: Cmd+- ‚Üí CollapseRegion, Cmd++ ‚Üí ExpandRegion (code folding)
"   New:     Cmd+- ‚Üí Decrease font, Cmd++ ‚Üí Increase font (zoom)
"
" We override code folding shortcuts for consistency with zoom expectations.
" Use leader-key for code folding instead: <leader>zc (collapse), <leader>ze (expand)
"
" Zoom shortcuts (overriding code folding):
map <D-=> <Action>(EditorIncreaseFontSize)
map <D-+> <Action>(EditorIncreaseFontSize)
map <D--> <Action>(EditorDecreaseFontSize)

" Alternative leader-key zoom (if you want both):
map <leader>zi <Action>(EditorIncreaseFontSize)
map <leader>zo <Action>(EditorDecreaseFontSize)
map <leader>zr <Action>(EditorResetFontSize)

" Code folding alternatives (since we remapped Cmd+/- to zoom):
map <leader>zc <Action>(CollapseRegion)
map <leader>ze <Action>(ExpandRegion)
map <leader>zC <Action>(CollapseAllRegions)
map <leader>zE <Action>(ExpandAllRegions)

" ===================================================================
" Which-Key Menu Descriptions
" ===================================================================
let g:WhichKeyDesc_split = "<leader>w [W]indow operations"
let g:WhichKeyDesc_search = "<leader>s [S]earch operations"
let g:WhichKeyDesc_goto = "<leader>g [G]oto / LSP operations"
let g:WhichKeyDesc_refactor = "<leader>r [R]efactor operations"
let g:WhichKeyDesc_code = "<leader>c [C]ode actions"
let g:WhichKeyDesc_new = "<leader>n [N]ew file operations"
let g:WhichKeyDesc_close = "<leader>q [Q]uit / close operations"
let g:WhichKeyDesc_doc = "<leader>K Quick [D]ocumentation"
let g:WhichKeyDesc_param = "<leader>p [P]arameter info"
let g:WhichKeyDesc_structure = "<leader>so [S]ymbol [O]utline"
let g:WhichKeyDesc_generate = "<leader>ge [Ge]nerate code"
let g:WhichKeyDesc_zoom = "<leader>z [Z]oom / font size / folding"
let g:WhichKeyDesc_zoom_in = "<leader>zi [Z]oom [I]n (increase font)"
let g:WhichKeyDesc_zoom_out = "<leader>zo [Z]oom [O]ut (decrease font)"
let g:WhichKeyDesc_zoom_reset = "<leader>zr [Z]oom [R]eset"
let g:WhichKeyDesc_fold_collapse = "<leader>zc [C]ollapse region (fold code)"
let g:WhichKeyDesc_fold_expand = "<leader>ze [E]xpand region (unfold code)"
let g:WhichKeyDesc_fold_collapse_all = "<leader>zC [C]ollapse all regions"
let g:WhichKeyDesc_fold_expand_all = "<leader>zE [E]xpand all regions"

" ===================================================================
" SUMMARY: Three-Layer Shortcut System
" ===================================================================
" Choose the appropriate layer based on your current workflow:
"
" üèéÔ∏è  FAST LAYER (Native - 1 keystroke):
"     Cmd+B, Option+Enter, Cmd+Option+L, Double Shift, Ctrl+T
"     Cmd+= or Cmd++ (zoom in), Cmd+- (zoom out) ‚ö° NEW!
"     Use when: Typing fast, maximum speed needed
"
" ‚ö° MEDIUM LAYER (Vim-style - 2 keystrokes):
"     gd, gr, gi, gh
"     Use when: Vim muscle memory, balanced speed/discoverability
"
" üß≠ DISCOVERABLE LAYER (Leader-key - 3 keystrokes):
"     <leader>gd, <leader>sf, <leader>ca
"     <leader>zi/zo/zr (zoom), <leader>zc/ze (code folding)
"     Use when: Exploring, learning, Which-Key menu helpful
"
" üìù ZOOM vs CODE FOLDING (Changed!):
"     Cmd+- (zoom out) ‚ö° NEW - overrides default CollapseRegion
"     Cmd++ (zoom in) ‚ö° NEW - overrides default ExpandRegion
"     <leader>zc (collapse code), <leader>ze (expand code) - use these for folding
"
" TIP: Start with leader-key for discoverability, graduate to Vim-style
"      for speed, and use native shortcuts for maximum performance.
" ===================================================================
